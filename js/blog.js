// Krijimi i të dhënave të artikujve për blogun e korit "Mrekullia"
// Çdo postim ka id, titull, datë, përmbledhje, përmbajtje, imazh, kategori dhe numër shikimesh
const posts = [
    {
        id: 1,
        title: "Kori i F&euml;mij&euml;ve 'Mrekullia' interpretojne k&euml;ng&euml;n 'Urim Mesueses' ne tvKlan",
        date: "7 Mars 2023",
        excerpt: "N&euml; prag t&euml; 7 Marsit, Korin e F&euml;mij&euml;ve \"Mrekullia\" solli nj&euml; performanc&euml; me k&euml;ng&euml;n \"Urim M&euml;sueses\" n&euml; ekranin e TV Klan, duke emocionuar publikun.",
       content: `<p>M&euml; 7 Mars 2023, n&euml; Dit&euml;n e M&euml;suesit, Korin e F&euml;mij&euml;ve "Mrekullia" pati nderin t&euml; jet&euml; pjes&euml; e programit festiv t&euml; transmetuar n&euml; TV Klan. Me z&euml;ra t&euml; past&euml;r dhe t&euml; mbushur me emocion, f&euml;mij&euml;t interpretuan k&euml;ng&euml;n "Urim M&euml;sueses", nj&euml; dedikim i veçant&euml; p&euml;r t&euml; gjith&euml; ata q&euml; i kushtojn&euml; jet&euml;n arsimimit dhe edukimit t&euml; brezave t&euml; rinj.</p>

<p>Performanca u prit ngrohtsisht nga audienca dhe sh&euml;rbeu si nj&euml; kujtes&euml; e bukur p&euml;r rolin e paz&euml;vend&euml;suesh&euml;m t&euml; m&euml;suesve n&euml; formimin e f&euml;mij&euml;ve. Kori, i njohur p&euml;r p&euml;rkushtimin dhe dashurin&euml; q&euml; p&euml;rcjell n&euml; çdo interpretim, e solli k&euml;t&euml; k&euml;ng&euml; me nj&euml; ndjeshmëri t&euml; veçant&euml;, duke e kthyer n&euml; nj&euml; urim t&euml; sinqert&euml; dhe prek&euml;s p&euml;r t&euml; gjith&euml; m&euml;suesit.</p>

<p>Kjo paraqitje televizive ishte nj&euml; tjet&euml;r hap i r&euml;nd&euml;sish&euml;m n&euml; rrug&euml;timin artistik t&euml; korit, q&euml; vazhdon t&euml; inspiroj&euml; dhe t&euml; sjell&euml; g&euml;zim p&euml;rmes muzik&euml;s s&euml; f&euml;mij&euml;ve.</p>
`,
        image: "../asete/foto/kengeMesuesitthumb.png",
        category: "aktivitete",
        views: 254
    },
    {
        id: 2,
        title: "Regjistrimet e Reja p&euml;r Sezonin 2025-2026",
        date: "20 Prill 2025",
        excerpt: "Kan&euml; filluar regjistrimet p&euml;r an&euml;tar&euml;t e rinj t&euml; korit 'Mrekullia'. Ftojm&euml; t&euml; gjith&euml; f&euml;mij&euml;t e apasionuar pas muzik&euml;s...",
        content: `<p>Kan&euml; filluar regjistrimet p&euml;r an&euml;tar&euml;t e rinj t&euml; korit 'Mrekullia'. Ftojm&euml; t&euml; gjith&euml; f&euml;mij&euml;t e apasionuar pas muzik&euml;s t&euml; b&euml;hen pjes&euml; e korit ton&euml; p&euml;r sezonin e ri 2025-2026.</p>
                  <p>Regjistrimet jan&euml; t&euml; hapura p&euml;r f&euml;mij&euml;t e moshave 7-14 vjeç dhe do t&euml; vazhdojn&euml; deri m&euml; 30 Maj 2025. Audicionet do t&euml; zhvillohen gjat&euml; fundjavave t&euml; muajit Qershor.</p>
                  <p>P&euml;r t&euml; regjistruar f&euml;mij&euml;n tuaj, ju lutemi t&euml; plot&euml;soni formularin online n&euml; faqen ton&euml; t&euml; internetit ose t&euml; vizitoni zyr&euml;n ton&euml; n&euml; adres&euml;n: Rruga "Ismail Qemali", Nr. 45, Tiran&euml;.</p>
                  <p>Kori ofron nj&euml; ambient t&euml; k&euml;ndsh&euml;m dhe profesional p&euml;r zhvillimin e talentit muzikor t&euml; f&euml;mij&euml;ve, n&euml;n drejtimin e specialist&euml;ve t&euml; muzik&euml;s.</p>
                  <p>P&euml;r çdo pyetje ose informacion shtes&euml;, mos hezitoni t&euml; na kontaktoni!</p>`,
        image: "../asete/foto/regjistrime.png",
        category: "njoftime",
        views: 187
    },
    {
        id: 3,
        title: "Kori i F&euml;mij&euml;ve 'Mrekullia' interpretojne k&euml;ng&euml;n e Flamurit Kuq e Zi",
        date: "30 N&euml;ntor 2024",
        excerpt: "N&euml; prag t&euml; Festave t&euml; N&euml;ntorit, Korin e F&euml;mij&euml;ve \"Mrekullia\" solli nj&euml; performanc&euml; me k&euml;ng&euml;n e Flamurit Kuq e Zi n&euml; ekranin e RTSH",
        content: `<p>M&euml; 30 N&euml;ntor 2024, Kori i F&euml;mij&euml;ve 'Mrekullia' mori pjes&euml; n&euml; nj&euml; program special n&euml; Televizionin Publik Shqiptar (RTSH), ku interpretoi me emocion dhe krenari k&euml;ng&euml;n patriotike 'Flamuri Kuq e Zi'.</p>
    <p>Performanca u mir&euml;prit nga publiku, duke v&euml;n&euml; n&euml; pah talentin dhe p&euml;rkushtimin e f&euml;mij&euml;ve si dhe r&euml;nd&euml;sin&euml; e trash&euml;gimis&euml; kulturore shqiptare n&euml; edukimin e brezave t&euml; rinj.</p>
    <p>Ky moment ishte pjes&euml; e nj&euml; iniciative p&euml;r t&euml; promovuar vlerat komb&euml;tare dhe artin koral p&euml;r f&euml;mij&euml; n&euml; media.</p>`,
        image: "../asete/foto/RTSH.png",
        category: "projekte",
        views: 342
    },
    {
        id: 4,
        title: "Kori i f&euml;mij&euml;ve 'Mrekullia' kolazh muzikor n&euml; 'E Diell'",
        date: "26 Maj 2019",
        excerpt: "Kori 'Mrekullia' organizoi nj&euml; aktivitet bamir&euml;s p&euml;r mbledhjen e fondeve p&euml;r f&euml;mij&euml;t n&euml; nevojë. Me k&euml;t&euml; rast...",
        content: `<p>Kori i f&euml;mij&euml;ve "Mrekullia" solli nj&euml; atmosfer&euml; plot ngjyra dhe energji n&euml; sken&euml;n e emisionit t&euml; njohur televiziv "E Diell" n&euml; Top Channel, p&euml;rmes nj&euml; kolazhi muzikor q&euml; p&euml;rfshinte k&euml;ng&euml; t&euml; dashura p&euml;r publikun.</p>
  <p>Kolazhi p&euml;rfshinte nj&euml; p&euml;rzgjedhje k&euml;ng&euml;sh shqiptare dhe nd&euml;rkomb&euml;tare, t&euml; interpretuara me harmoni dhe g&euml;zim nga f&euml;mij&euml;t e korit. Performanca u shoq&euml;rua me koreografi t&euml; leht&euml; dhe nj&euml; prezenc&euml; skenike mbres&euml;l&euml;n&euml;se.</p>
  <p>Publiku dhe stafi i emisionit u shpreh&euml;n t&euml; emocionuar nga energjia dhe profesionalizmi i f&euml;mij&euml;ve, duke vler&euml;suar pun&euml;n e palodhur t&euml; dirigjent&euml;ve dhe organizator&euml;ve t&euml; korit.</p>
  <p>Kjo paraqitje ishte nj&euml; d&euml;shmi tjet&euml;r e talentit dhe p&euml;rkushtimit q&euml; Kori "Mrekullia" sjell n&euml; çdo sken&euml; ku ngjitet.</p>`,
        image: "../asete/foto/kolazhPatriotikthumb.png",
        category: "aktivitete",
        views: 213
    },
]

// Zgjedhja e elementeve DOM për manipulim
// Përdorimi i getElementById për të marrë elementët nga faqja HTML
const postsContainer = document.getElementById('posts-container');
const paginationContainer = document.getElementById('pagination');
const popularPostsContainer = document.getElementById('popular-posts-container');
const postModal = document.getElementById('post-modal');
const modalTitle = document.getElementById('modal-title');
const modalDate = document.getElementById('modal-date');
const modalImg = document.getElementById('modal-img');
const modalContent = document.getElementById('modal-content');
const closeModal = document.getElementById('close-modal');
const subscribeForm = document.getElementById('subscribe-form');
const emailInput = document.getElementById('email-input');
const successMessage = document.getElementById('success-message');
const errorMessage = document.getElementById('error-message');
const searchInput = document.getElementById('search-input');
const searchButton = document.getElementById('search-button');
const filterOptions = document.querySelectorAll('input[name="filter"]');

// Variablat kryesore për funksionimin e blogut
// currentPage ruan faqen aktuale të shfaqur
// postsPerPage përcakton numrin e postimeve në një faqe
// filteredPosts ruan postimet e filtruara për shfaqje
let currentPage = 1;
const postsPerPage = 6;
let filteredPosts = [...posts];

// Funksioni kryesor për inicializimin e blogut
// Thërret funksionet për shfaqjen e postimeve, postimeve popullore dhe vendos event listeners
function initializeBlog() {
    displayPosts();
    displayPopularPosts();
    setupEventListeners();
}

// Funksioni për shfaqjen e postimeve me faqosje (pagination)
// Pastron postimet e mëparshme, llogarit faqosjen dhe shfaq postimet aktuale
function displayPosts() {
    // Pastron HTML e mëparshëm të kontejnerit të postimeve
    postsContainer.innerHTML = '';

    // Llogarit faqosjen bazuar në numrin total të postimeve dhe numrin e postimeve për faqe
    const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
    const startIndex = (currentPage - 1) * postsPerPage;
    const endIndex = startIndex + postsPerPage;
    const currentPosts = filteredPosts.slice(startIndex, endIndex);

    // Shfaq postimet e faqes aktuale ose mesazh nëse nuk ka rezultate
    if (currentPosts.length > 0) {
        currentPosts.forEach(post => {
            const postElement = createPostElement(post);
            postsContainer.appendChild(postElement);
        });
    } else {
        postsContainer.innerHTML = '<div class="no-results">Nuk u gjet asnj&euml; postim me k&euml;to kritere.</div>';
    }

    // Krijon lidhjet e faqosjes
    createPagination(totalPages);
}

// Funksioni për krijimin e elementit HTML për një postim
// Krijon strukturën dhe vendos përmbajtjen e postimit, si dhe vendos event listener për klikimin
function createPostElement(post) {
    const postDiv = document.createElement('div');
    postDiv.className = 'post';
    postDiv.setAttribute('data-id', post.id);

    postDiv.innerHTML = `
    <img src="${post.image}" alt="${post.title}" class="post-img">
    <div class="post-content">
        <h2 class="post-title">${post.title}</h2>
        <p class="post-date">${post.date}</p>
        <p class="post-excerpt">${post.excerpt}</p>
        <a class="read-more">Lexo m&euml; shum&euml;</a>
    </div>
    `;

    // Vendos event listener për hapjen e modalit kur klikohet butoni "Lexo më shumë"
    postDiv.querySelector('.read-more').addEventListener('click', () => {
        openPostModal(post);
    });

    // Vendos event listener për hapjen e modalit kur klikohet kudo në postim
    postDiv.addEventListener('click', () => {
        openPostModal(post);
    });

    return postDiv;
}

// Funksioni për krijimin e lidhjeve të faqosjes (pagination)
// Krijon numrat e faqeve dhe vendos event listeners për ndryshimin e faqes
function createPagination(totalPages) {
    paginationContainer.innerHTML = '';

    // Nëse ka vetëm një faqe, nuk shfaqet faqosja
    if (totalPages <= 1) {
        return;
    }

    // Krijon lidhjet për çdo faqe
    for (let i = 1; i <= totalPages; i++) {
        const pageLink = document.createElement('a');
        pageLink.className = `page-link ${i === currentPage ? 'active' : ''}`;
        pageLink.textContent = i;

        // Vendos event listener për të ndryshuar faqen kur klikohet një numër faqeje
        pageLink.addEventListener('click', () => {
            currentPage = i;
            displayPosts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        paginationContainer.appendChild(pageLink);
    }
}

// Funksioni për shfaqjen e postimeve popullore në sidebar
// Rendit postimet sipas numrit të shikimeve dhe shfaq 3 më të popullorat
function displayPopularPosts() {
    // Pastron HTML e mëparshëm të kontejnerit të postimeve popullore
    popularPostsContainer.innerHTML = '';

    // Rendit postimet sipas numrit të shikimeve (më të shikuarat në fillim) dhe merr 3 të parat
    const sortedPosts = [...posts].sort((a, b) => b.views - a.views).slice(0, 3);

    // Shfaq 3 postimet më popullore
    sortedPosts.forEach(post => {
        const popularPostDiv = document.createElement('div');
        popularPostDiv.className = 'popular-post';

        popularPostDiv.innerHTML = `
            
            <div class="popular-post-content">
                <h4>${post.title}</h4>
                <p>${post.date}</p>
            </div>
        `;

        // Vendos event listener për hapjen e modalit kur klikohet postimi
        popularPostDiv.addEventListener('click', () => {
            openPostModal(post);
        });

        popularPostsContainer.appendChild(popularPostDiv);
    });
}

// Funksioni për hapjen e modalit të postimit
// Vendos përmbajtjen e postimit në modal dhe e bën atë të dukshëm
// Gjithashtu zëvendëson karakterin 'ë' me '&euml;' për shfaqje të saktë
function openPostModal(post) {
    // Zëvendëson 'ë' me '&euml;' në titullin e postimit
    modalTitle.innerHTML = post.title.replace(/ë/g, '&euml;');
    
    // Vendos datën e postimit (zakonisht datat nuk kanë 'ë')
    modalDate.textContent = post.date;
    
    // Vendos imazhin dhe tekstin alt
    modalImg.src = post.image;
    modalImg.alt = post.title.replace(/ë/g, '&euml;');
    
    // Vendos përmbajtjen e postimit
    // Nuk është nevoja të bëjmë zëvendësim sepse përmbajtja tashmë përmban &euml;
    modalContent.innerHTML = post.content;
    
    // Shfaq modalin
    postModal.style.display = 'block';
    document.body.style.overflow = 'hidden'; // Parandalon lëvizjen e faqes kur modali është i hapur
}

// Funksioni për mbylljen e modalit të postimit
// Fsheh modalin dhe rikthen lëvizjen normale të faqes
function closePostModal() {
    postModal.style.display = 'none';
    document.body.style.overflow = 'auto'; // Riaktivizon lëvizjen e faqes
}

// Funksioni për filtrimin e postimeve
// Filtron postimet sipas kriterit të përzgjedhur: më të rejat, më të vjetrat, ose sipas kategorisë
function filterPosts(filterValue) {
    if (filterValue === 'newest') {
        // Rendit sipas më të rejave (duke supozuar që postimet e para në array janë më të rejat)
        filteredPosts = [...posts].sort((a, b) => {
            return posts.indexOf(a) - posts.indexOf(b);
        });
    } else if (filterValue === 'oldest') {
        // Rendit sipas më të vjetrave (anasjelltas nga array)
        filteredPosts = [...posts].sort((a, b) => {
            return posts.indexOf(b) - posts.indexOf(a);
        });
    } else if (filterValue === 'announcements') {
        // Filtron vetëm postimet e kategorisë 'njoftime'
        filteredPosts = posts.filter(post => post.category === 'njoftime');
    } else {
        // Default - shfaq të gjitha postimet
        filteredPosts = [...posts];
    }

    currentPage = 1; // Rikthehet në faqen e parë
    displayPosts();
}

// Funksioni për kërkimin e postimeve
// Kërkon në titull, përmbledhje dhe përmbajtje të postimeve për termin e kërkimit
function searchPosts(query) {
    if (!query.trim()) {
        filteredPosts = [...posts];
    } else {
        query = query.toLowerCase();
        filteredPosts = posts.filter(post => {
            return post.title.toLowerCase().includes(query) || 
                   post.excerpt.toLowerCase().includes(query) || 
                   post.content.toLowerCase().includes(query);
        });
    }

    currentPage = 1; // Rikthehet në faqen e parë
    displayPosts();
}

// Funksioni për validimin e formatit të emailit
// Përdor regex për të kontrolluar nëse emaili ka formatin e duhur
function validateEmail(email) {
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
}

// Funksioni për trajtimin e formës së abonimit
// Kontrollon vlefshmërinë e emailit dhe shfaq mesazhin përkatës
function handleSubscribe(e) {
    e.preventDefault();

    const email = emailInput.value.trim();

    if (!validateEmail(email)) {
        // Shfaq mesazhin e gabimit
        errorMessage.style.display = 'block';
        successMessage.style.display = 'none';
        emailInput.focus();
        setTimeout(() => {
            errorMessage.style.display = 'none';
        }, 3000);
    } else {
        // Shfaq mesazhin e suksesit
        successMessage.style.display = 'block';
        errorMessage.style.display = 'none';
        emailInput.value = '';

        // Krijon një alert të personalizuar (modal)
        const alertModal = document.createElement('div');
        alertModal.style.position = 'fixed';
        alertModal.style.top = '50%';
        alertModal.style.left = '50%';
        alertModal.style.transform = 'translate(-50%, -50%)';
        alertModal.style.backgroundColor = 'white';
        alertModal.style.padding = '2rem';
        alertModal.style.borderRadius = '8px';
        alertModal.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';
        alertModal.style.zIndex = '2000';
        alertModal.style.maxWidth = '400px';
        alertModal.style.width = '80%';
        alertModal.style.textAlign = 'center';

        alertModal.innerHTML = `
            <h3 style="color: #9C2D2F; margin-bottom: 1rem;">Faleminderit!</h3>
            <p style="margin-bottom: 1.5rem;">Je abonuar me sukses n&euml; blogun e Korit "Mrekullia".</p>
            <button style="background-color: #9C2D2F; color: white; border: none; padding: 0.5rem 1.5rem; border-radius: 4px; cursor: pointer;">Mbyll</button>
        `;

        // Shton sfondin e errët
        const backdrop = document.createElement('div');
        backdrop.style.position = 'fixed';
        backdrop.style.top = '0';
        backdrop.style.left = '0';
        backdrop.style.width = '100%';
        backdrop.style.height = '100%';
        backdrop.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        backdrop.style.zIndex = '1999';

        document.body.appendChild(backdrop);
        document.body.appendChild(alertModal);

        // Mbyll modalin kur klikohet butoni
        alertModal.querySelector('button').addEventListener('click', () => {
            document.body.removeChild(alertModal);
            document.body.removeChild(backdrop);
        });

        // Mbyllja automatike pas 5 sekondash
        setTimeout(() => {
            if (document.body.contains(alertModal)) {
                document.body.removeChild(alertModal);
                document.body.removeChild(backdrop);
            }
        }, 5000);
    }
}

// Funksioni për vendosjen e dëgjuesve të ngjarjeve (event listeners)
// Vendos event listeners për modalin, formën e abonimit, kërkimin dhe filtrimet
function setupEventListeners() {
    // Mbyll modalin kur klikohet butoni i mbylljes ose jashtë modalit
    closeModal.addEventListener('click', closePostModal);
    window.addEventListener('click', (e) => {
        if (e.target === postModal) {
            closePostModal();
        }
    });

    // Mbyllja e modalit me tastierë (tasti Escape)
    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && postModal.style.display === 'block') {
            closePostModal();
        }
    });

    // Dërgimi i formës së abonimit
    subscribeForm.addEventListener('submit', handleSubscribe);

    // Funksionaliteti i kërkimit
    searchButton.addEventListener('click', () => {
        searchPosts(searchInput.value);
    });

    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            searchPosts(searchInput.value);
        }
    });

    // Opsionet e filtrimit
    filterOptions.forEach(option => {
        option.addEventListener('change', () => {
            if (option.checked) {
                filterPosts(option.value);
            }
        });
    });
}

// Inicializimi i blogut kur ngarkimi i DOM-it është i plotë
document.addEventListener('DOMContentLoaded', initializeBlog);